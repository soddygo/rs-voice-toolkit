# STT 模块性能基线

本文档记录了 STT 模块的性能基线指标，用于监控性能变化和优化效果。

## 测试环境

- **模型**: ggml-tiny.bin (Whisper Tiny 模型)
- **测试音频**: fixtures/audio/jfk.wav (11.0秒，JFK演讲片段)
- **测试平台**: macOS
- **测试时间**: 2024年12月

## 性能指标

### 实时因子 (RTF)

| 指标 | 数值 |
|------|------|
| 平均 RTF | 0.019 |
| 最小 RTF | 0.018 |
| 最大 RTF | 0.020 |

**评估**: ✅ 性能优秀 (RTF < 0.3，实时性能良好)

### 处理时间

| 指标 | 数值 (ms) |
|------|----------|
| 平均处理时间 | 372 |
| 最小处理时间 | 306 |
| 最大处理时间 | 410 |

### 内存使用

| 指标 | 数值 (MB) |
|------|----------|
| 平均内存变化 | 14.0 |
| 最小内存变化 | 3 |
| 最大内存变化 | 23 |

### 识别质量

| 指标 | 数值 |
|------|------|
| 平均置信度 | 0.834 |
| 最小置信度 | 0.834 |
| 最大置信度 | 0.834 |

**评估**: ✅ 识别质量优秀 (平均置信度 > 0.8)

### 音频信息

| 指标 | 数值 |
|------|------|
| 音频时长 | 11.0 秒 |
| 平均文本长度 | 106 字符 |
| 平均段落数 | 1.0 |

## 性能基准

### RTF 基准

- **优秀**: RTF < 0.3 (可实时处理)
- **良好**: 0.3 ≤ RTF < 1.0 (接近实时)
- **需优化**: RTF ≥ 1.0 (无法实时处理)

### 置信度基准

- **优秀**: 置信度 > 0.8
- **良好**: 0.6 < 置信度 ≤ 0.8
- **需优化**: 置信度 ≤ 0.6

### 内存使用基准

- **正常**: 内存变化 < 50MB
- **注意**: 50MB ≤ 内存变化 < 100MB
- **需优化**: 内存变化 ≥ 100MB

## 使用方法

### 运行性能基线测试

```bash
# 基本测试 (3次迭代)
cargo run -p stt --example performance_baseline -- fixtures/models/ggml-tiny.bin fixtures/audio/jfk.wav

# 自定义迭代次数
cargo run -p stt --example performance_baseline -- fixtures/models/ggml-tiny.bin fixtures/audio/jfk.wav 5
```

### 测试不同模型

```bash
# 使用不同大小的模型进行对比测试
cargo run -p stt --example performance_baseline -- fixtures/models/ggml-tiny.bin fixtures/audio/jfk.wav 5
cargo run -p stt --example performance_baseline -- fixtures/models/ggml-base.bin fixtures/audio/jfk.wav 5
```

## 性能优化建议

### 当前状态

✅ **RTF 优秀**: 当前 RTF 为 0.019，远低于实时处理要求 (1.0)，性能表现优异

✅ **识别质量优秀**: 平均置信度 0.834，识别准确性良好

✅ **内存使用合理**: 平均内存变化 14MB，在正常范围内

### 优化方向

1. **模型选择优化**
   - Tiny 模型: 速度快，适合实时场景
   - Base 模型: 平衡速度和准确性
   - Large 模型: 最高准确性，适合离线处理

2. **硬件优化**
   - 使用 GPU 加速 (如果支持)
   - 增加 CPU 线程数
   - 优化内存分配策略

3. **音频预处理优化**
   - 音频降噪
   - 音量标准化
   - 静音检测和跳过

## 监控建议

1. **定期运行基线测试**: 每次重要更新后运行性能测试
2. **监控关键指标**: 重点关注 RTF 和置信度变化
3. **记录性能变化**: 建立性能变化历史记录
4. **设置性能告警**: RTF > 0.5 或置信度 < 0.7 时需要关注

## 历史记录

| 日期 | 版本 | RTF | 置信度 | 内存(MB) | 备注 |
|------|------|-----|--------|----------|------|
| 2024-12 | v0.1.0 | 0.019 | 0.834 | 14.0 | 初始基线 |

---

*注: 性能指标可能因硬件配置、系统负载等因素而有所差异*